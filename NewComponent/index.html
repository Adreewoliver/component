<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vagas de Emprego</title>
  <link rel="stylesheet" href="./card.css">
  <script type="module" src="./src/components/CardNews.js" defer></script>
</head>

<body>
  <header>
    <h1 style="text-align:center; margin-top: 20px;color: aliceblue;">Portal de Vagas</h1>
  </header>

  <nav style="text-align:center; margin: 20px 0;">
    <a href="pagina5.html" style="margin-right: 15px; text-decoration: none; color: #ffffff; font-weight: bold;">Cadastrar Vaga</a>
    <a href="index.html" style="text-decoration: none; color: #ffffff; font-weight: bold;">Ver Vagas</a>
  </nav>

  <main>
    <h2 style="text-align:center; margin: 20px 0; color: #ffffff;">Vagas Cadastradas</h2>
    <div id="vagasContainer" style="display: flex; flex-wrap: wrap; justify-content: center;"></div>
  </main>

  <footer style="text-align:center; margin: 40px 0; color: #ffffff;">
    <button id="apagarVagas">🗑️ Apagar Todas as Vagas</button>
    <p style="margin-top: 20px;">© 2025 vagas | Desenvolvido por Adriano de Oliveira Santos</p>
  </footer>

  <script type="module">
    // Importa TODAS as funções que esta página usa
    import { getVagas, apagarTodasVagas, deleteVagaById } from './src/app.js';

    const vagasContainer = document.getElementById("vagasContainer");

    // --- Lógica para carregar os cards ---
    function carregarVagas() {
      vagasContainer.innerHTML = ''; // Limpa antes de carregar
      const vagas = getVagas(); 

      if (vagas.length === 0) {
        vagasContainer.innerHTML = "<p>Nenhuma vaga cadastrada no momento.</p>";
      }

      vagas.forEach((vaga) => {
        const card = document.createElement("card-news");
        card.setAttribute("titulo", vaga.titulo);
        card.setAttribute("descricao", vaga.descricao);
        card.setAttribute("categoria", vaga.categoria);
        card.setAttribute("imagem", vaga.imagem);
        card.setAttribute("nome", vaga.nome);
        card.setAttribute("link", `pagina2.html?id=${vaga.id}`);
        // Passa o ID para o componente usar nos botões
        card.setAttribute("vaga-id", vaga.id); 
        vagasContainer.appendChild(card);
      });
    }

    // --- Lógica do botão de apagar TUDO ---
    document.getElementById("apagarVagas").addEventListener("click", () => {
      if (confirm("Tem certeza que deseja apagar TODAS as vagas cadastradas?")) {
        apagarTodasVagas();
        alert("Todas as vagas foram apagadas com sucesso!");
        carregarVagas(); // Recarrega a lista
      }
    });

    // --- Lógica para APAGAR UMA VAGA (Ouvindo o evento do CardNews) ---
    vagasContainer.addEventListener('delete-vaga', (event) => {
      const idParaApagar = event.detail.id;
      
      deleteVagaById(idParaApagar); // Usa a função do app.js
      
      alert("Vaga apagada com sucesso!");
      carregarVagas(); // Recarrega a lista de vagas
    });

    // Carrega as vagas quando a página é aberta
    document.addEventListener("DOMContentLoaded", carregarVagas);
  </script>
</body>
</html>